---
# https://taskfile.dev
version: '3'
includes:
  agent:
    taskfile: ./agent_generic_base/Taskfile.yml
    dir: ./agent_generic_base
tasks:
  default:
    desc: "ğŸ—’ï¸ Show all available tasks"
    cmds:
      - task --list
    silent: true
  setup:
    desc: "ğŸ—ï¸ Setup the agent and infra environments"
    cmds:
      - echo "Updating agent environment"
      - task: agent:req
      - echo "Updating infra environment"
      - cd ./infra && uv sync --all-extras
    silent: true
  build:
    desc: "ğŸ”µ [agent_generic_base] Run Pulumi up in [BUILD] mode"
    env:
      AGENT_DEPLOY: 0
    cmds:
      - echo "Running pulumi up with [BUILD] mode"
      - cd ./infra && pulumi up
    silent: true
  deploy:
    desc: "ğŸŸ¢ [agent_generic_base] Run Pulumi up in [DEPLOY] mode"
    env:
      AGENT_DEPLOY: 1
    cmds:
      - echo "Running pulumi up with [DEPLOY] mode"
      - cd ./infra && pulumi up
    silent: true
  destroy:
    desc: "ğŸ”´ [agent_generic_base] Run Pulumi destroy"
    cmds:
      - echo "Running pulumi destroy"
      - cd ./infra && pulumi destroy
    silent: true
