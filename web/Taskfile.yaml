---
version: '3'
tasks:
  install:
    desc: ðŸ”§ Install dependencies
    cmds:
      - echo "ðŸ”§ Installing dependencies.."
      - uv sync --all-extras --dev
  dev:
    silent: true
    desc: ðŸ”¨ Run the development server
    cmds:
      - echo "ðŸ”¨ Starting development server"
      - uv run uvicorn app.main:app --host 0.0.0.0 --port 8080 --reload
    env:
      # TEST_USER_EMAIL: example@developer.com
  dev-agent:
    silent: true
    desc: "ðŸ”¨ Run the development server with the local agent server"
    env:
      AGENT_DEPLOYMENT_URL: http://localhost:8842
      # TEST_USER_EMAIL: example@developer.com
    cmds:
      - echo "ðŸ”¨ Starting development server"
      - uv run uvicorn app.main:app --host 0.0.0.0 --port 8080 --reload
  lint:
    silent: true
    desc: ðŸ§¹ Run linters
    cmds:
      - echo "ðŸ§¹ Running linters.."
      - uv run ruff format .
      - uv run ruff check . --fix
      - uv run mypy --pretty .
  lint-check:
    silent: true
    desc: ðŸ§¹ Check whether the codebase is linted
    cmds:
      - uv run ruff format --check .
      - uv run ruff check .
      - uv run mypy --pretty .
  test:
    silent: true
    desc: ðŸ§ª Run tests
    cmds:
      - echo "ðŸ§ª Running tests.."
      - uv run pytest --cov --cov-report=html --cov-report=term --cov-report xml:.coverage.xml
  copyright:
    aliases:
      - license
    desc: ðŸ“œ Apply license headers
    cmds:
      - echo "ðŸ“œ Applying license headers"
      - docker run  --rm -v $PWD:/github/workspace ghcr.io/apache/skywalking-eyes/license-eye:eb0e0b091ea41213f712f622797e37526ca1e5d6
        -v info -c .licenserc.yaml header fix
  copyright-check:
    aliases:
      - license-check
    desc: ðŸ“œ Checking for license headers
    cmds:
      - echo "ðŸ“œ Checking license headers"
      - docker run  --rm -v $PWD:/github/workspace ghcr.io/apache/skywalking-eyes/license-eye:eb0e0b091ea41213f712f622797e37526ca1e5d6
        -v info -c .licenserc.yaml header check
