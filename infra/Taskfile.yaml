---
# https://taskfile.dev
version: '3'

tasks:
  install:
    desc: "ğŸ”§ Install dependencies"
    cmds:
      - echo "ğŸ”§ Installing dependencies.."
      - uv sync --all-extras --dev

  lint:
    silent: true
    desc: "ğŸ§¹ Run linters"
    cmds:
      - echo "ğŸ§¹ Running linters.."
      - uv run ruff format .
      - uv run ruff check . --fix
      - uv run mypy --pretty .

  lint-check:
    silent: true
    desc: "ğŸ§¹ Check whether the codebase is linted"
    cmds:
      - uv run ruff format --check .
      - uv run ruff check .
      - uv run mypy --pretty .

  init:
    silent: true
    desc: "ğŸ†• Initialize a new Pulumi stack"
    cmds:
      - uv run pulumi stack init

  select:
    silent: true
    desc: "ğŸš‚ Select a Stack"
    cmds:
      - uv run pulumi stack select

  up:
    silent: true
    aliases: [deploy]
    desc: "ğŸ”¨ Deploy the infrastructure"
    cmds:
      - echo "ğŸ”¨ Deploying the infrastructure.."
      - uv run pulumi up

  info:
    silent: true
    desc: "â„¹ï¸ Show Pulumi stack info"
    cmds:
      - uv run pulumi stack

  down:
    silent: true
    aliases: [destroy]
    desc: "ğŸ’¥ Destroy the deployed infrastructure"
    cmds:
      - echo "ğŸ’¥ Destroying the infrastructure.."
      - uv run pulumi down

  copyright:
    aliases: [license]
    desc: ğŸ“œ Apply license headers
    cmds:
      - echo "ğŸ“œ Applying license headers"
      - docker run  --rm -v $PWD:/github/workspace ghcr.io/apache/skywalking-eyes/license-eye:eb0e0b091ea41213f712f622797e37526ca1e5d6
        -v info -c .licenserc.yaml header fix

  copyright-check:
    aliases: [license-check]
    desc: ğŸ“œ Checking for license headers
    cmds:
      - echo "ğŸ“œ Checking license headers"
      - docker run  --rm -v $PWD:/github/workspace ghcr.io/apache/skywalking-eyes/license-eye:eb0e0b091ea41213f712f622797e37526ca1e5d6
        -v info -c .licenserc.yaml header check
